{% extends "layout.html" %} {% block title %} Search references {% endblock %}
{% block body %}

<h2 class="head-form">Search references</h2>
  
<form class="form" action="/search_references" method="get">
  
  <div class="form-field">
    <label for="query">Search:</label>
    <input type="text" name="query" value="{{ query or '' }}" />
  </div>

  <button class="btn-create" type="submit">Search</button>
  <button class="btn-neutral" type="button" onclick="window.location.href='/'">
    Back to Home
  </button>
</form>

{% if query %}
<h3>Search results: {{ results|length }}</h3>

<div>
  <p>
    <button
      class="btn-create"
      type="button"
      onclick="document.getElementById('export-form').submit()"
    >
      Export BibTeX
    </button>

    <label>
      <input type="checkbox" id="select-all">
      Select all
    </label>
  </p>
</div>

{% with messages = get_flashed_messages() %} {% if messages %}
  <ul>
    {% for message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %} {% endwith %}

<form id="export-form" action="/export_bibtex" method="POST">
  <input type="hidden" name="query" value="{{ query }}">
  <input type="hidden" name="from_search" value="true">
  <div class="references-list">
    {% for reference in results %}
    <div class="reference-card">
      <div class="reference-header">
        <input
          type="checkbox"
          name="reference_ids"
          value="{{ reference.id }}"
          id="checkbox-{{ loop.index }}"
        />
        <a class="reference-title" href="/reference/{{ reference.id }}"
          >{{ reference.title }}</a
        >
      </div>

      <div class="reference-meta">
        <p><strong>Author(s):</strong> {{ reference.author }}</p>
        <p><strong>Year:</strong> {{ reference.year }}</p>
        <p><strong>Type:</strong> {{ reference.reference_type }}</p>
        <p><strong>Cite key:</strong> {{ reference.cite_key }}</p>
        {% if reference.reference_type == "book" %} {% if reference.publisher %}
        <p><strong>Publisher:</strong> {{ reference.publisher }}</p>
        {% endif %} {% if reference.chapter %}
        <p><strong>Chapter:</strong> {{ reference.chapter }}</p>
        {% endif %} {% elif reference.reference_type == "article" %} {% if
        reference.journal %}
        <p><strong>Journal:</strong> {{ reference.journal }}</p>
        {% endif %} {% if reference.volume %}
        <p><strong>Volume:</strong> {{ reference.volume }}</p>
        {% endif %} {% if reference.pages %}
        <p><strong>Pages:</strong> {{ reference.pages }}</p>
        {% endif %} {% elif reference.reference_type == "inproceedings" %} {% if
        reference.booktitle %}
        <p><strong>Booktitle:</strong> {{ reference.booktitle }}</p>
        {% endif %} {% elif reference.reference_type == "misc" %} {% if
        reference.url %}
        <p><strong>Url:</strong> {{ reference.url }}</p>
        {% endif %} {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</form>

{% endif %}
{% endblock %}