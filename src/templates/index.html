{% extends "layout.html" %} {% block title %} References app {% endblock %} {%
block body %}
<h2>References app</h2>

<div>
  <p>
    <button class="btn-create" onclick="window.location.href='/new_reference'">
      Create a new reference
    </button>

    <button class="btn-create" onclick="window.location.href='/new_reference_doi'">
    Add reference by DOI
    </button>

    <button class="btn-create" onclick="window.location.href='/search_references'">
      Search references
    </button>

    <button class="btn-create" id="bounce-cat">Click me :3</button>
    <div id="cat-container" style="display:none;">
      <img src="{{ url_for('static', filename='kissa.gif') }}" id="bouncing-cat" alt="Bouncing Cat" />
    </div>

    <button
      class="btn-create"
      type="button"
      onclick="document.getElementById('export-form').submit()"
    >
      Export BibTeX
    </button>

    <label>
      <input type="checkbox" id="select-all">
      Select all
    </label>
  </p>
  {% with messages = get_flashed_messages() %} {% if messages %}
  <ul>
    {% for message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %} {% endwith %}
  <form id="export-form" action="/export_bibtex" method="POST">
    <div class="references-list">
      {% for reference in references %}
      <div class="reference-card">
        <div class="reference-header">
          <input
            type="checkbox"
            name="reference_ids"
            value="{{ reference.id }}"
            id="checkbox-{{ loop.index }}"
          />
          <a class="reference-title" href="/reference/{{ reference.id }}"
            >{{ reference.title }}</a
          >
        </div>

        <div class="reference-meta">
          <p><strong>Author(s):</strong> {{ reference.author }}</p>
          <p><strong>Year:</strong> {{ reference.year }}</p>
          <p><strong>Type:</strong> {{ reference.reference_type }}</p>
          <p><strong>Cite key:</strong> {{ reference.cite_key }}</p>

      {% if reference.reference_type == "book" %} {% if reference.publisher %}
      <p><strong>Publisher:</strong> {{ reference.publisher }}</p>
      {% endif %} {% if reference.chapter %}
      <p><strong>Chapter:</strong> {{ reference.chapter }}</p>
      {% endif %} {% elif reference.reference_type == "article" %} {% if
      reference.journal %}
      <p><strong>Journal:</strong> {{ reference.journal }}</p>
      {% endif %} {% if reference.volume %}
      <p><strong>Volume:</strong> {{ reference.volume }}</p>
      {% endif %} {% if reference.pages %}
      <p><strong>Pages:</strong> {{ reference.pages }}</p>
      {% endif %} {% elif reference.reference_type == "inproceedings" %} {% if
      reference.booktitle %}
      <p><strong>Booktitle:</strong> {{ reference.booktitle }}</p>
      {% endif %} {% elif reference.reference_type == "misc" %} {% if
      reference.url %}
      <p><strong>URL:</strong> {{ reference.url }}</p>
      {% endif %} {% endif %}
        </div>

        <!-- Tags Section -->
        <div class="tags-section">
          <div class="tags-display">
            {% for tag in reference.tags.all() %}
              <span class="tag-badge" data-tag-id="{{ tag.id }}" data-reference-id="{{ reference.id }}">
                {{ tag.name }}
                <button type="button" class="tag-remove" onclick="removeTag({{ reference.id }}, {{ tag.id }})">&times;</button>
              </span>
            {% endfor %}
          </div>
          <div class="tag-input-container">
            <input 
              type="text" 
              class="tag-input" 
              placeholder="Add tag..." 
              id="tag-input-{{ reference.id }}"
              onkeypress="if(event.key==='Enter'){event.preventDefault();addTag({{ reference.id }})}"
            />
            <button type="button" class="btn-add-tag" onclick="addTag({{ reference.id }})">+</button>
          </div>
        </div>
      </div>
      {% else %}
      <p>No references yet</p>
      {% endfor %}
    </div>
  </form>
</div>
{% endblock %}
